---
import { getCollection } from "astro:content";

// Get the latest newsletter
const allNewsletters = await getCollection("newsletters");
const latestNewsletter = allNewsletters
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())[0];
const baseUrl = import.meta.env.BASE_URL.replace(/\/$/, "");
---

{latestNewsletter && (
  <section class="bg-gradient-to-br from-tqcc-pink to-tqcc-black py-20">
    <div class="max-w-4xl mx-auto px-4">
      <div class="text-center mb-8">
        <div class="inline-flex items-center gap-2 bg-tqcc-yellow text-tqcc-black font-bold px-6 py-3 rounded-full text-lg mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
            <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z"></path>
            <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z"></path>
          </svg>
          LATEST NEWSLETTER
        </div>
        <h2 class="text-3xl lg:text-4xl font-bold text-white mb-2">
          {latestNewsletter.data.month} {latestNewsletter.data.year}
        </h2>
      </div>

      <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
        <a href={`${baseUrl}/newsletters/${latestNewsletter.id}`} class="block group">
          <img
            src={latestNewsletter.data.heroImage.startsWith('/') ? `${baseUrl}${latestNewsletter.data.heroImage}` : latestNewsletter.data.heroImage}
            alt={`${latestNewsletter.data.month} ${latestNewsletter.data.year} Newsletter`}
            class="w-full h-auto group-hover:opacity-95 transition-opacity"
          />
        </a>
      </div>

      <div class="flex flex-col sm:flex-row gap-4 mt-8 justify-center">
        <a
          href={`${baseUrl}/newsletters/${latestNewsletter.id}`}
          class="inline-block bg-tqcc-yellow text-tqcc-black font-bold px-8 py-4 rounded-lg hover:bg-white transition-all transform hover:scale-105 shadow-lg hover:shadow-xl text-center"
        >
          View Newsletter
        </a>
        <a
          href={`${baseUrl}/newsletters`}
          class="inline-block bg-white text-tqcc-black font-bold px-8 py-4 rounded-lg hover:bg-tqcc-yellow transition-colors text-center"
        >
          View Archive
        </a>
      </div>
    </div>
  </section>
)}
